<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>11 Help | SPEAQeasy</title>
  <meta name="description" content="11 Help | SPEAQeasy" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="11 Help | SPEAQeasy" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="11 Help | SPEAQeasy" />
  
  
  

<meta name="author" content="Nicholas J. Eagles" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="software.html"/>
<link rel="next" href="glossary.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>



</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a></li>
<li class="chapter" data-level="2" data-path="quick-start.html"><a href="quick-start.html"><i class="fa fa-check"></i><b>2</b> Quick Start</a><ul>
<li class="chapter" data-level="2.1" data-path="quick-start.html"><a href="quick-start.html#setup"><i class="fa fa-check"></i><b>2.1</b> Setup</a></li>
<li class="chapter" data-level="2.2" data-path="quick-start.html"><a href="quick-start.html#configuration"><i class="fa fa-check"></i><b>2.2</b> Configuration</a><ul>
<li class="chapter" data-level="2.2.1" data-path="quick-start.html"><a href="quick-start.html#your-main-script"><i class="fa fa-check"></i><b>2.2.1</b> Your “main” script</a></li>
<li class="chapter" data-level="2.2.2" data-path="quick-start.html"><a href="quick-start.html#your-config-file"><i class="fa fa-check"></i><b>2.2.2</b> Your config file</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="setup-details.html"><a href="setup-details.html"><i class="fa fa-check"></i><b>3</b> Setup Details</a><ul>
<li class="chapter" data-level="3.1" data-path="setup-details.html"><a href="setup-details.html#requirements"><i class="fa fa-check"></i><b>3.1</b> Requirements</a></li>
<li class="chapter" data-level="3.2" data-path="setup-details.html"><a href="setup-details.html#installation"><i class="fa fa-check"></i><b>3.2</b> Installation</a></li>
<li class="chapter" data-level="3.3" data-path="setup-details.html"><a href="setup-details.html#run-the-pipeline"><i class="fa fa-check"></i><b>3.3</b> Run the Pipeline</a><ul>
<li class="chapter" data-level="3.3.1" data-path="setup-details.html"><a href="setup-details.html#run-in-a-slurm-environment-cluster"><i class="fa fa-check"></i><b>3.3.1</b> Run in a SLURM environment/ cluster</a></li>
<li class="chapter" data-level="3.3.2" data-path="setup-details.html"><a href="setup-details.html#run-on-a-sun-grid-engines-sge-cluster"><i class="fa fa-check"></i><b>3.3.2</b> Run on a Sun Grid Engines (SGE) cluster</a></li>
<li class="chapter" data-level="3.3.3" data-path="setup-details.html"><a href="setup-details.html#run-locally"><i class="fa fa-check"></i><b>3.3.3</b> Run locally</a></li>
<li class="chapter" data-level="3.3.4" data-path="setup-details.html"><a href="setup-details.html#run-on-the-jhpce-cluster"><i class="fa fa-check"></i><b>3.3.4</b> Run on the <span>JHPCE</span> cluster</a></li>
<li class="chapter" data-level="3.3.5" data-path="setup-details.html"><a href="setup-details.html#example-main-script"><i class="fa fa-check"></i><b>3.3.5</b> Example main script</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="command-opts.html"><a href="command-opts.html"><i class="fa fa-check"></i><b>4</b> All Command Options</a><ul>
<li class="chapter" data-level="4.1" data-path="command-opts.html"><a href="command-opts.html#speaqeasy-options"><i class="fa fa-check"></i><b>4.1</b> SPEAQeasy Options</a><ul>
<li class="chapter" data-level="4.1.1" data-path="command-opts.html"><a href="command-opts.html#mandatory-parameters"><i class="fa fa-check"></i><b>4.1.1</b> Mandatory Parameters</a></li>
<li class="chapter" data-level="4.1.2" data-path="command-opts.html"><a href="command-opts.html#optional-parameters"><i class="fa fa-check"></i><b>4.1.2</b> Optional Parameters</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="command-opts.html"><a href="command-opts.html#nextflow-options"><i class="fa fa-check"></i><b>4.2</b> Nextflow Options</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="pipeline-overview.html"><a href="pipeline-overview.html"><i class="fa fa-check"></i><b>5</b> Pipeline Overview</a><ul>
<li class="chapter" data-level="5.1" data-path="pipeline-overview.html"><a href="pipeline-overview.html#preparation-steps"><i class="fa fa-check"></i><b>5.1</b> Preparation Steps</a><ul>
<li class="chapter" data-level="5.1.1" data-path="pipeline-overview.html"><a href="pipeline-overview.html#downloading-required-annotation-files"><i class="fa fa-check"></i><b>5.1.1</b> Downloading required annotation files</a></li>
<li class="chapter" data-level="5.1.2" data-path="pipeline-overview.html"><a href="pipeline-overview.html#preparing-annotation-files-for-direct-use"><i class="fa fa-check"></i><b>5.1.2</b> Preparing annotation files for direct use</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="pipeline-overview.html"><a href="pipeline-overview.html#main-workflow-steps"><i class="fa fa-check"></i><b>5.2</b> Main Workflow Steps</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="annotation.html"><a href="annotation.html"><i class="fa fa-check"></i><b>6</b> Annotation</a><ul>
<li class="chapter" data-level="6.1" data-path="annotation.html"><a href="annotation.html#default-annotation"><i class="fa fa-check"></i><b>6.1</b> Default Annotation</a><ul>
<li class="chapter" data-level="6.1.1" data-path="annotation.html"><a href="annotation.html#choosing-a-release"><i class="fa fa-check"></i><b>6.1.1</b> Choosing a release</a></li>
<li class="chapter" data-level="6.1.2" data-path="annotation.html"><a href="annotation.html#choosing-a-build"><i class="fa fa-check"></i><b>6.1.2</b> Choosing a “build”</a></li>
<li class="chapter" data-level="6.1.3" data-path="annotation.html"><a href="annotation.html#additional-annotation-files"><i class="fa fa-check"></i><b>6.1.3</b> Additional Annotation files</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="annotation.html"><a href="annotation.html#custom-annotation"><i class="fa fa-check"></i><b>6.2</b> Custom Annotation</a><ul>
<li class="chapter" data-level="6.2.1" data-path="annotation.html"><a href="annotation.html#optional-files-to-include-depending-on-your-use-case"><i class="fa fa-check"></i><b>6.2.1</b> Optional files to include depending on your use-case</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="manifest.html"><a href="manifest.html"><i class="fa fa-check"></i><b>7</b> Manifest and Inputs</a><ul>
<li class="chapter" data-level="7.1" data-path="manifest.html"><a href="manifest.html#what-the-manifest-should-look-like"><i class="fa fa-check"></i><b>7.1</b> What the Manifest Should Look Like</a><ul>
<li class="chapter" data-level="7.1.1" data-path="manifest.html"><a href="manifest.html#more-details-regarding-inputs"><i class="fa fa-check"></i><b>7.1.1</b> More details regarding inputs</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="outputs.html"><a href="outputs.html"><i class="fa fa-check"></i><b>8</b> Pipeline Outputs</a></li>
<li class="chapter" data-level="9" data-path="quick-start.html"><a href="quick-start.html#configuration"><i class="fa fa-check"></i><b>9</b> Configuration</a><ul>
<li class="chapter" data-level="9.1" data-path="configuration.html"><a href="configuration.html"><i class="fa fa-check"></i><b>9.1</b> Specifying Options for your Cluster</a><ul>
<li class="chapter" data-level="9.1.1" data-path="configuration.html"><a href="configuration.html#time"><i class="fa fa-check"></i><b>9.1.1</b> Time</a></li>
<li class="chapter" data-level="9.1.2" data-path="configuration.html"><a href="configuration.html#cluster-specific-options"><i class="fa fa-check"></i><b>9.1.2</b> Cluster-specific options</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="configuration.html"><a href="configuration.html#speaqeasy-parameters"><i class="fa fa-check"></i><b>9.2</b> SPEAQeasy Parameters</a><ul>
<li class="chapter" data-level="9.2.1" data-path="configuration.html"><a href="configuration.html#annotation-settings"><i class="fa fa-check"></i><b>9.2.1</b> Annotation settings</a></li>
<li class="chapter" data-level="9.2.2" data-path="configuration.html"><a href="configuration.html#software-settings"><i class="fa fa-check"></i><b>9.2.2</b> Software settings</a></li>
<li class="chapter" data-level="9.2.3" data-path="configuration.html"><a href="configuration.html#miscellaneous-settings"><i class="fa fa-check"></i><b>9.2.3</b> Miscellaneous settings</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="software.html"><a href="software.html"><i class="fa fa-check"></i><b>10</b> Software Versions</a><ul>
<li class="chapter" data-level="10.1" data-path="software.html"><a href="software.html#docker-images"><i class="fa fa-check"></i><b>10.1</b> Docker Images</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="help.html"><a href="help.html"><i class="fa fa-check"></i><b>11</b> Help</a><ul>
<li class="chapter" data-level="11.1" data-path="help.html"><a href="help.html#common-errors"><i class="fa fa-check"></i><b>11.1</b> Common Errors</a></li>
<li class="chapter" data-level="11.2" data-path="help.html"><a href="help.html#deeper-investigation"><i class="fa fa-check"></i><b>11.2</b> Deeper Investigation</a><ul>
<li class="chapter" data-level="11.2.1" data-path="help.html"><a href="help.html#checking-per-sample-logs"><i class="fa fa-check"></i><b>11.2.1</b> Checking Per-Sample Logs</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="help.html"><a href="help.html#resuming"><i class="fa fa-check"></i><b>11.3</b> Resuming</a><ul>
<li class="chapter" data-level="11.3.1" data-path="help.html"><a href="help.html#trouble-resuming"><i class="fa fa-check"></i><b>11.3.1</b> Trouble resuming?</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="help.html"><a href="help.html#no-internet-access"><i class="fa fa-check"></i><b>11.4</b> No Internet Access?</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="glossary.html"><a href="glossary.html"><i class="fa fa-check"></i><b>12</b> Glossary</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">SPEAQeasy</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="help" class="section level1">
<h1><span class="header-section-number">11</span> Help</h1>
<div id="common-errors" class="section level2">
<h2><span class="header-section-number">11.1</span> Common Errors</h2>
<p>SPEAQeasy should be configured so that fundamental issues related to pipeline function do not arise. If you encounter an error and believe it to be a design flaw in SPEAQeasy, you can always <a href="https://github.com/LieberInstitute/SPEAQeasy/issues">submit a github issue</a>. However, please take a look at the following common issues:</p>
<ul>
<li><em>A job/ process is not given enough memory or time</em>: pipeline runs on large samples or datasets may require more memory or a higher time limit. When reported correctly, the pipeline will indicate an error status of 140 (for SGE or SLURM environments); however, memory issues can take many forms, and related error messages are not always clear. In this example case, the process PairedEndHISAT failed due to insufficient memory, but indicated a general error status (1):</li>
</ul>
<div class="figure">
<img src="images/10.1_error.png" alt="" />
<p class="caption">How Nextflow may report memory-related errors</p>
</div>
<p>Attempt to provide the process more memory in your config. In this case the configuration for PairedEndHISAT looks like this:</p>
<div class="figure">
<img src="images/10.1_memory.png" alt="" />
<p class="caption">Memory Configuration</p>
</div>
<p>Note that disk space may also be the limitation (particularly for SGE users). See the <a href="quick-start.html#configuration">configuration</a> section for more info.</p>
<ul>
<li><p><em>Strandness for at least one sample disagrees with the asserted value</em>: all samples for a particular pipeline run are expected to have the same “strandness”, specified by the <code>--strand</code> <a href="command-opts.html#command-opts">command option</a> in your <a href="quick-start.html#quick-start">main script</a>. SPEAQeasy infers the strandness for each sample to verify your data has its expected structure- by default, when any sample is determined to have a strandness different than what is specified, the pipeline halts with an error. This is designed to catch faulty data quickly before analysis, but also consider the <code>--force_strand</code> <a href="command-opts.html#command-opts">command option</a> to suppress errors of this kind.</p></li>
<li><p><em>biomaRt databases cannot be reached</em>: when aggregating gene/exon/junction counts in the <code>CountObjects</code> <a href="pipeline-overview.html#pipeline-overview">process</a>, biomaRt databases are queried for some additional annotation (namely gene IDs). Since this information is sometimes desired for downstream analysis, the pipeline will halt if unable to reach the databases (a fairly common event). The user can choose to either resume [NEEDS A LINK] as-is: to re-attempt the CountObjects process with the biomaRt query, or resume without requiring this information (see the <code>--no_biomart</code> <a href="command-opts.html#command-opts">command option</a>).</p></li>
<li><p><em>Nextflow has trouble communicating with your cluster</em>: a less common issue can occur on slower clusters, related to nextflow failing to poll your grid scheduler (like SGE or SLURM) for information it needs about the jobs that are running. This can show up in an error message like: <code>Process</code>PairedEndHISAT (Prefix: Sample_FE2P1_blood)<code>terminated for an unknown reason -- Likely it has been terminated by the external system</code>. We have found that raising the <code>exitReadTimeout</code> to a large value (such as 30 minutes) solves this issue, but consider raising it further if needed.</p></li>
</ul>
<div class="figure">
<img src="images/10.1_communication.png" alt="" />
<p class="caption">Communication error with slow clusters</p>
</div>
</div>
<div id="deeper-investigation" class="section level2">
<h2><span class="header-section-number">11.2</span> Deeper Investigation</h2>
<p>If pipeline execution halts with an error, and the cause/solution does not appear to be described in the common issues [LINK TO 10.1], what can be done? This section provides information about next steps for debugging a potential problem.</p>
<div id="checking-per-sample-logs" class="section level3">
<h3><span class="header-section-number">11.2.1</span> Checking Per-Sample Logs</h3>
<p>At the end of each pipeline run (whether complete or after halting due to an error), SPEAQeasy generates logs to trace the exact series of steps each sample underwent. These are designed primarily as a debugging tool, especially to catch issues that may be sample-specific. Identifying the source of an error generally involves the following steps:</p>
<ol style="list-style-type: decimal">
<li><em>Identify the failing process and sample name</em>: the main output log from nextflow will be called “SPEAQeasy_output.log” by default (it is generally a very long text file). SPEAQeasy automatically compiles the most typically relevant information in this log; however, the error message (if applicable) at the bottom of the log is typically helpful for pinpointing the process and sample where the error occurred. <em>Note</em>: if a sample name is not given with the process name, the process involves all samples. Look for a message similar to the following:</li>
</ol>
<div class="figure">
<img src="images/10.2_error_mess.png" alt="" />
<p class="caption">Main error message in SPEAQeasy_output.log</p>
</div>
<ol start="2" style="list-style-type: decimal">
<li><p><em>Find the SPEAQeasy-generated log for the failing sample</em>: logs are located under the output folder specified by the <code>--output</code> <a href="command-opts.html#command-opts">command flag</a>- by default, this will be <code>SPEAQeasy/results/logs/</code>. Simply find the sample name given by step 1 (or pick any sample if no name was provided).</p></li>
<li><p><em>Locate the process from step 1 in the log from step 2</em>: because the processes are in order of reported submission, the failed process will typically be near the bottom of the log. The most immediately informative portion to look for is usually the logged output from executing that process. This is at the bottom between the dashed lines labelled <em>BEGIN LOG</em> and <em>END LOG</em>.</p></li>
</ol>
<div class="figure">
<img src="images/10.2_process_name.png" alt="" />
<p class="caption">Locating the appropriate process in your log</p>
</div>
<div class="figure">
<img src="images/10.2_log.png" alt="" />
<p class="caption">Locating the output for the process</p>
</div>
<p>If the log output does not make it clear what wrong, explore the following:</p>
<ul>
<li><p><em>Check the exit code</em>: this is near the top for a given process. An exit code of 1 is often not very informative by itself (a generic error status), but other values can sometimes inform you of the exact issue. For example, the common exit status of 140 indicates that a process failed due to exceeding memory, disk, CPU, or time constraints (for SGE or SLURM clusters). Most frequently, memory is the limiting factor; consider raising the memory allocated for the process in the relevant <a href="quick-start.html#configuration">configuration file</a>.</p></li>
<li><p><em>Check the content of the working directory</em>: the path to the relevant working directory is given on the first line of the log for a given process. One immediate “red flag” could be a core dump (a file named something like <code>core.[numbers]</code>). These files are produced when a process unexpectedly terminates, which often can indicate the process needs more memory or disk space (see <a href="quick-start.html#configuration">configuration</a>). It is also worth checking for other log files (certain processes, like <em>SingleEndHISAT</em> and <em>PairedEndHISAT</em>, have output which is not printed between the <em>BEGIN LOG</em> and <em>END LOG</em> per-sample log sections).</p></li>
</ul>
</div>
</div>
<div id="resuming" class="section level2">
<h2><span class="header-section-number">11.3</span> Resuming</h2>
<p>An important feature of SPEAQeasy (because it is based on nextflow) is the ability to resume pipeline execution if an error occurs for any reason. To resume, you must add the <code>-resume</code> flag to your “main” script, determined <a href="quick-start.html#quick-start">here</a>, and rerun. Otherwise, the default is to restart the entire pipeline, regardless of how much progress was made!</p>
<div id="trouble-resuming" class="section level3">
<h3><span class="header-section-number">11.3.1</span> Trouble resuming?</h3>
<p>In some cases, nextflow will improperly determine which processes have finished, when a pipeline run halts with an error. This can be related to how your filesystem communicates with nextflow. We have found that specifying <code>cache = 'lenient'</code> in the process section of the config fixes issues with resuming (such as re-running a process which had actually completed). See <a href="https://www.nextflow.io/docs/latest/process.html#cache">nextflow’s documentation on this</a>. In your config, this could look like:</p>
<div class="figure">
<img src="images/10.2_cache.png" alt="" />
<p class="caption">Relaxing settings involving resuming a partially-complete pipeline run</p>
</div>
<p>This is the default in <code>jhpce.config</code>, <code>sge.config</code>, and <code>docker_sge.config</code>, but may be needed on other cluster types as well.</p>
</div>
</div>
<div id="no-internet-access" class="section level2">
<h2><span class="header-section-number">11.4</span> No Internet Access?</h2>
<ul>
<li>For users who do not have internet access when executing pipeline runs, you may first run <code>bash scripts/manual_annotation.sh</code>. This script must be run from the repository directory (from a machine with internet access). Modify the four lines in the “user configuration section” at the top of the script for your particular set-up. This sets up everything so that subsequent runs of the pipeline do not need an internet connection to complete.</li>
<li>Towards the end of the pipeline run, when R objects are created containing gene/exon/junction counts, some additional data is <a href="https://bioconductor.org/packages/release/bioc/html/biomaRt.html">pulled from biomaRt</a> databases by default. However, if an internet connection is not available, this extra information is not pulled (and an error occurs). Users without access to the internet during pipeline execution should provide the <code>--no_biomart</code> <a href="command-opts.html#command-opts">command flag</a> to suppress this error and continue without the additional biomaRt data. This is the only difference between runs with and without internet access.</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="software.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="glossary.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
